AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: 'ApiBuilder code generator deployment'
Resources:
  GeneratorsFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: ../
      Events:
        Get:
          Type: Api
          Properties:
            Path: '/generators/{key}'
            Method: get
        GetAll:
          Type: Api
          Properties:
            Path: '/generators'
            Method: get
      FunctionName: !Sub '${AWS::StackName}-generators'
      Handler: src/main/js/index.configHandler
      Runtime: nodejs6.10
  HealthCheckFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: ../
      Events:
        Get:
          Type: Api
          Properties:
            Path: '/_internal_/healthcheck'
            Method: get
      FunctionName: !Sub '${AWS::StackName}-healthcheck'
      Handler: src/main/js/index.healthCheckHandler
      Runtime: nodejs6.10
  InvocationsFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: ../
      Events:
        Get:
          Type: Api
          Properties:
            Path: '/invocations/{key}'
            Method: post
      FunctionName: !Sub '${AWS::StackName}-invocations'
      Handler: src/main/js/index.healthCheckHandler
      Runtime: nodejs6.10
  GeneratorsFunctionLogRetention:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/aws/lambda/${GeneratorsFunction}'
      RetentionInDays: 7
  HealthCheckFunctionLogRetention:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/aws/lambda/${HealthCheckFunction}'
      RetentionInDays: 7
  InvocationsFunctionLogRetention:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/aws/lambda/${InvocationsFunction}'
      RetentionInDays: 7
